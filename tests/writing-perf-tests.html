
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Writing a new test Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../files/" />
    
    
    <link rel="prev" href="performance-tests.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../getting-started/">
            
                <a href="../getting-started/">
            
                    
                    Getting started
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../getting-started/bugzilla.html">
            
                <a href="../getting-started/bugzilla.html">
            
                    
                    Get a Bugzilla account
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../getting-started/build.html">
            
                <a href="../getting-started/build.html">
            
                    
                    Get and build the code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../getting-started/development-profiles.html">
            
                <a href="../getting-started/development-profiles.html">
            
                    
                    Create a development profile
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../contributing.html">
            
                <a href="../contributing.html">
            
                    
                    Contributing
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../contributing/find-bugs.html">
            
                <a href="../contributing/find-bugs.html">
            
                    
                    Find bugs to work on
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../contributing/fixing-bugs.html">
            
                <a href="../contributing/fixing-bugs.html">
            
                    
                    How to fix a bug
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../contributing/code-reviews.html">
            
                <a href="../contributing/code-reviews.html">
            
                    
                    Code reviews
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="../contributing/code-reviews-setup.html">
            
                <a href="../contributing/code-reviews-setup.html">
            
                    
                    Set up for code reviews
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.2" data-path="../contributing/code-reviews-find-reviewer.html">
            
                <a href="../contributing/code-reviews-find-reviewer.html">
            
                    
                    Find a reviewer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.3" data-path="../contributing/making-prs.html">
            
                <a href="../contributing/making-prs.html">
            
                    
                    Send your code for review
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.4" data-path="../contributing/code-reviews-checklist.html">
            
                <a href="../contributing/code-reviews-checklist.html">
            
                    
                    Reviews checklist
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../contributing/landing-code.html">
            
                <a href="../contributing/landing-code.html">
            
                    
                    Landing code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../contributing/levelling-up.html">
            
                <a href="../contributing/levelling-up.html">
            
                    
                    Levelling up
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../contributing/coding-standards.html">
            
                <a href="../contributing/coding-standards.html">
            
                    
                    Coding standards
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.6.1" data-path="../contributing/javascript.html">
            
                <a href="../contributing/javascript.html">
            
                    
                    JavaScript
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.6.1.1" data-path="../contributing/eslint.html">
            
                <a href="../contributing/eslint.html">
            
                    
                    ESLint
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.6.2" data-path="../contributing/css.html">
            
                <a href="../contributing/css.html">
            
                    
                    CSS
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../contributing/filing-good-bugs.html">
            
                <a href="../contributing/filing-good-bugs.html">
            
                    
                    Filing good bugs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../contributing/performance.html">
            
                <a href="../contributing/performance.html">
            
                    
                    Investigating performance issues
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="../contributing/react-performance-tips.html">
            
                <a href="../contributing/react-performance-tips.html">
            
                    
                    Writing efficient React code
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="./">
            
                <a href="./">
            
                    
                    Automated tests
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" >
            
                <span>
            
                    
                    Running tests
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1.1" data-path="xpcshell.html">
            
                <a href="xpcshell.html">
            
                    
                    xpcshell
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.2" data-path="mochitest-chrome.html">
            
                <a href="mochitest-chrome.html">
            
                    
                    Chrome mochitests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.3" data-path="mochitest-devtools.html">
            
                <a href="mochitest-devtools.html">
            
                    
                    DevTools mochitests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.4" data-path="tips.html">
            
                <a href="tips.html">
            
                    
                    Tips
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="writing-tests.html">
            
                <a href="writing-tests.html">
            
                    
                    Writing tests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="debugging-intermittents.html">
            
                <a href="debugging-intermittents.html">
            
                    
                    Debugging intermittent failures
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="performance-tests.html">
            
                <a href="performance-tests.html">
            
                    
                    Performance tests (DAMP)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.4.4.1" data-path="writing-perf-tests.html">
            
                <a href="writing-perf-tests.html">
            
                    
                    Writing a new test
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../files/">
            
                <a href="../files/">
            
                    
                    Files and directories
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../files/adding-files.html">
            
                <a href="../files/adding-files.html">
            
                    
                    Adding New Files
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../tools/tools.html">
            
                <a href="../tools/tools.html">
            
                    
                    Tool Architectures
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../tools/inspector.html">
            
                <a href="../tools/inspector.html">
            
                    
                    Inspector
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1.1" data-path="../tools/inspector-panel.html">
            
                <a href="../tools/inspector-panel.html">
            
                    
                    Panel Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.2" data-path="../tools/highlighters.html">
            
                <a href="../tools/highlighters.html">
            
                    
                    Highlighters
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../tools/memory-panel.html">
            
                <a href="../tools/memory-panel.html">
            
                    
                    Memory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../tools/debugger-panel.html">
            
                <a href="../tools/debugger-panel.html">
            
                    
                    Debugger
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../tools/responsive-design-mode.html">
            
                <a href="../tools/responsive-design-mode.html">
            
                    
                    Responsive Design Mode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../tools/http-inspector.html">
            
                <a href="../tools/http-inspector.html">
            
                    
                    HTTP Inspector
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../tools/console-panel.html">
            
                <a href="../tools/console-panel.html">
            
                    
                    Console
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../frontend/frontend.html">
            
                <a href="../frontend/frontend.html">
            
                    
                    Frontend
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../frontend/svgs.html">
            
                <a href="../frontend/svgs.html">
            
                    
                    Panel SVGs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../frontend/react.html">
            
                <a href="../frontend/react.html">
            
                    
                    React
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.2.1" data-path="../frontend/react-guidelines.html">
            
                <a href="../frontend/react-guidelines.html">
            
                    
                    Guidelines
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../frontend/redux.html">
            
                <a href="../frontend/redux.html">
            
                    
                    Redux
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.3.1" data-path="../frontend/redux-guidelines.html">
            
                <a href="../frontend/redux-guidelines.html">
            
                    
                    Guidelines
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../frontend/telemetry.html">
            
                <a href="../frontend/telemetry.html">
            
                    
                    Telemetry
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../backend/backend.html">
            
                <a href="../backend/backend.html">
            
                    
                    Backend
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../backend/protocol.html">
            
                <a href="../backend/protocol.html">
            
                    
                    Remote Debugging Protocol
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../backend/client-api.html">
            
                <a href="../backend/client-api.html">
            
                    
                    Client API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../backend/debugger-api.html">
            
                <a href="../backend/debugger-api.html">
            
                    
                    Debugger API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../backend/backward-compatibility.html">
            
                <a href="../backend/backward-compatibility.html">
            
                    
                    Backward Compatibility
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" >
            
                <span>
            
                    
                    Actors
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.5.1" data-path="../backend/actor-hierarchy.html">
            
                <a href="../backend/actor-hierarchy.html">
            
                    
                    Actors Organization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.2" data-path="../backend/actor-e10s-handling.html">
            
                <a href="../backend/actor-e10s-handling.html">
            
                    
                    Handling Multi-Processes in Actors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.3" data-path="../backend/protocol.js.html">
            
                <a href="../backend/protocol.js.html">
            
                    
                    Writing Actors With protocol.js
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.4" data-path="../backend/actor-registration.html">
            
                <a href="../backend/actor-registration.html">
            
                    
                    Registering A New Actor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.5" data-path="../backend/actor-best-practices.html">
            
                <a href="../backend/actor-best-practices.html">
            
                    
                    Actor Best Practices
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../preferences.html">
            
                <a href="../preferences.html">
            
                    
                    Preferences
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../about-documentation.html">
            
                <a href="../about-documentation.html">
            
                    
                    About this documentation
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Writing a new test</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="writing-new-performance-test">Writing new performance test</h1>
<p>See <a href="performance-tests.html">Performance tests (DAMP)</a> for an overall description of our performance tests.
Here, we will describe how to write a new test with an example: track the performance of clicking inside the inspector panel.</p>
<h2 id="consider-modifying-existing-tests-first">Consider modifying existing tests first</h2>
<p>If a <code>custom</code> page already exists for the tool you are testing, try to modify the existing <code>custom</code> test rather than adding a new individual test.</p>
<p>New individual tests run separately, in new tabs, and make DAMP slower than just modifying existing tests. Complexifying <code>custom</code> test pages should also help cover more scenarios and catch more regressions. For those reasons, modifying existing tests should be the preferred way of extending DAMP coverage.</p>
<p><code>custom</code> tests are using complex documents that should stress a particular tool in various ways. They are all named <code>custom.${tool}</code> (for instance <code>custom.inspector</code>). The test pages for those tests can be found in <a href="https://searchfox.org/mozilla-central/source/testing/talos/talos/tests/devtools/addon/content/pages/custom" target="_blank">pages/custom</a>.</p>
<p>If your test case requires a dedicated document or can&apos;t run next to the other tests in the current <code>custom</code> test, follow the instructions below to add a new individual test.</p>
<h2 id="where-is-the-code-for-the-test">Where is the code for the test?</h2>
<p>For now, all the tests live in a single file <a href="https://searchfox.org/mozilla-central/source/testing/talos/talos/tests/devtools/addon/content/damp.js" target="_blank">damp.js</a>.</p>
<p>There are two kinds of tests:</p>
<ul>
<li><p>The first kind is being run against two documents:</p>
<ul>
<li>&quot;Simple&quot;, an empty webpage. This one helps highlighting the load time of panels,</li>
<li>&quot;Complicated&quot;, a copy of bild.be, a German newspaper website. This allows us to examine the performance of the tools when inspecting complicated, big websites.</li>
</ul>
<p>To run your test against these two documents, add it to <a href="https://searchfox.org/mozilla-central/rev/cd742d763809089925a38178dd2ba5a9069fa855/testing/talos/talos/tests/devtools/addon/content/damp.js#563-673" target="_blank">this function</a>.</p>
<p>Look for <code>_getToolLoadingTests</code> function. There is one method per tool. Since we want to test how long does it take to click on the inspector, we will find the <code>inspector</code> method, and add the new test code there, like this:</p>
<pre><code>_getToolLoadingTests(url, label, { expectedMessages, expectedSources }) {
  let tests = {
    async inspector() {
      await this.testSetup(url);
      let toolbox = await this.openToolboxAndLog(label + &quot;.inspector&quot;, &quot;inspector&quot;);
      await this.reloadInspectorAndLog(label, toolbox);

      // &lt;== here we are going to add some code to test &quot;click&quot; performance,
      //     after the inspector is opened and after the page is reloaded.

      await this.closeToolboxAndLog(label + &quot;.inspector&quot;);
      await this.testTeardown();
    },
</code></pre></li>
<li><p>The second kind isn&apos;t specific to any document. You can come up with your own test document, or not involve any document if you don&apos;t need one.
If that better fits your needs, you should introduce an independent test function. Like <a href="https://searchfox.org/mozilla-central/rev/cd742d763809089925a38178dd2ba5a9069fa855/testing/talos/talos/tests/devtools/addon/content/damp.js#330-348" target="_blank">this one</a> or <a href="https://searchfox.org/mozilla-central/rev/cd742d763809089925a38178dd2ba5a9069fa855/testing/talos/talos/tests/devtools/addon/content/damp.js#350-402" target="_blank">this other one</a>. You also have to register the new test function you just introduced in this <a href="https://searchfox.org/mozilla-central/rev/cd742d763809089925a38178dd2ba5a9069fa855/testing/talos/talos/tests/devtools/addon/content/damp.js#863-864" target="_blank"><code>tests</code> object within <code>startTest</code> function</a>.</p>
<p>You could also use extremely simple documents specific to your test case like this:</p>
<pre><code>/**
 * Measure the time necessary to click in the inspector panel
 */
async _inspectorClickTest() {
  // Define here your custom document via a data URI:
  let url = &quot;data:text/html,custom test document&quot;;
  let tab = await this.testSetup(url);
  let messageManager = tab.linkedBrowser.messageManager;
  let toolbox = await this.openToolbox(&quot;inspector&quot;);

  // &lt;= Here, you would write your test actions,
  // after opening the inspector against a custom document

  await this.closeToolbox();
  await this.testTeardown();
},
...
startTest(doneCallback, config) {
  ...
  // And you have to register the test in `startTest` function
  // `tests` object is keyed by test names. So our test is named &quot;inspector.click&quot; here.
  tests[&quot;inspector.click&quot;] = this._inspectorClickTest;
  ...
}
</code></pre></li>
</ul>
<h2 id="how-to-name-your-test-and-register-it">How to name your test and register it?</h2>
<p>If your are writing a test executing against Simple and Complicated documents, your test name will look like: <code>(simple|complicated).${tool-name}.${test-name}</code>.
So for our example, it would be <code>simple.inspector.click</code> and <code>complicated.inspector.click</code>.
For independent tests that don&apos;t use the Simple or Complicated documents, the test name only needs to start with the tool name, if the test is specific to that tool
For the example, it would be <code>inspector.click</code>.</p>
<p>Once you come up with a name, you will have to register your test <a href="https://searchfox.org/mozilla-central/rev/cd742d763809089925a38178dd2ba5a9069fa855/testing/talos/talos/tests/devtools/addon/content/damp.html#12-42" target="_blank">here</a> and <a href="https://searchfox.org/mozilla-central/rev/cd742d763809089925a38178dd2ba5a9069fa855/testing/talos/talos/tests/devtools/addon/content/damp.html#44-71" target="_blank">here</a> with a short description of it.</p>
<h2 id="how-to-write-a-performance-test">How to write a performance test?</h2>
<p>When you write a performance test, in most cases, you only care about the time it takes to complete a very precise action.
There is a <code>runTest</code> helper method that helps recording a precise action duration:</p>
<pre><code>// Calling `runTest` will immediately start recording your action duration.
// You can execute any necessary setup action you don&apos;t want to record before calling it.
let test = this.runTest(&quot;my.test.name&quot;); // `runTest` expects the test name as argument

// &lt;== Do an action you want to record here

// Once your action is completed, call `runTest` returned object&apos;s `done` method.
// It will automatically record the action duration and appear in PerfHerder as a new subtest.
// It also creates markers in the profiler so that you can better inspect this action in
// profiler.firefox.com.
test.done();
</code></pre><p>So for our click example it would be:</p>
<pre><code>async inspector() {
  await this.testSetup(url);
  let toolbox = await this.openToolboxAndLog(label + &quot;.inspector&quot;, &quot;inspector&quot;);
  await this.reloadInspectorAndLog(label, toolbox);

  let inspector = toolbox.getPanel(&quot;inspector&quot;);
  let window = inspector.panelWin; // Get inspector&apos;s panel window object
  let body = window.document.body;

  await new Promise(resolve =&gt; {
    let test = this.runTest(&quot;inspector.click&quot;);
    body.addEventListener(&quot;click&quot;, function () {
      test.done();
      resolve();
    }, { once: true });
    body.click();
  });
}
</code></pre><h2 id="how-to-run-your-new-test">How to run your new test?</h2>
<p>You can run any performance test with this command:</p>
<pre><code>./mach talos-test --activeTests damp --subtest ${your-test-name}
</code></pre><p>By default, it will run the test 25 times. In order to run it just once, do:</p>
<pre><code>./mach talos-test --activeTests damp --subtest ${your-test-name} --cycles 1 --tppagecycles 1
</code></pre><p><code>--cycles</code> controls the number of times Firefox is restarted
<code>--tppagecycles</code> defines the number of times we repeat the test after each Firefox start</p>
<p>Also, you can record a profile while running the test. To do that, execute:</p>
<pre><code>./mach talos-test --activeTests damp --subtest ${your-test-name} --cycles 1 --tppagecycles 1 --geckoProfile --geckoProfileEntries 100000000
</code></pre><p><code>--geckoProfiler</code> enables the profiler
<code>--geckoProfileEntries</code> defines the profiler buffer size, which needs to be large while recording performance tests</p>
<p>Once it is done executing, the profile lives in a zip file you have to uncompress like this:</p>
<pre><code>unzip testing/mozharness/build/blobber_upload_dir/profile_damp.zip
</code></pre><p>Then you have to open <a href="https://profiler.firefox.com/" target="_blank">https://profiler.firefox.com/</a> and manually load the profile file that lives here: <code>profile_damp/page_0_pagecycle_1/cycle_0.profile</code></p>
<h2 id="how-to-write-a-good-performance-test">How to write a good performance test?</h2>
<h3 id="verify-that-you-wait-for-all-asynchronous-code">Verify that you wait for all asynchronous code</h3>
<p>If your test involves asynchronous code, which is very likely given the DevTools codebase, please review carefully your test script.
You should ensure that <em>any</em> code ran directly or indirectly by your test is completed.
You should not only wait for the functions related to the very precise feature you are trying to measure.</p>
<p>This is to prevent introducing noise in the test run after yours. If any asynchronous code is pending,
it is likely to run in parallel with the next test and increase its variance.
Noise in the tests makes it hard to detect small regressions.</p>
<p>You should typically wait for:</p>
<ul>
<li>All RDP requests to finish,</li>
<li>All DOM Events to fire,</li>
<li>Redux action to be dispatched,</li>
<li>React updates,</li>
<li>...</li>
</ul>
<h3 id="ensure-that-its-results-change-when-regressingfixing-the-code-or-feature-you-want-to-watch">Ensure that its results change when regressing/fixing the code or feature you want to watch.</h3>
<p>If you are writing the new test to cover a recent regression and you have a patch to fix it, push your test to try without <em>and</em> with the regression fix.
Look at the try push and confirm that your fix actually reduces the duration of your perf test significantly.
If you are introducing a test without any patch to improve the performance, try slowing down the code you are trying to cover with a fake slowness like <code>setTimeout</code> for asynchronous code, or very slow <code>for</code> loop for synchronous code. This is to ensure your test would catch a significant regression.</p>
<p>For our click performance test, we could do this from the inspector codebase:</p>
<pre><code>window.addEventListener(&quot;click&quot;, function () {

  // This for loop will fake a hang and should slow down the duration of our test
  for (let i = 0; i &lt; 100000000; i++) {}

}, true); // pass `true` in order to execute before the test click listener
</code></pre><h3 id="keep-your-test-execution-short">Keep your test execution short.</h3>
<p>Running performance tests is expensive. We are currently running them 25 times for each changeset landed in Firefox.
Aim to run tests in less than a second on try.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="performance-tests.html" class="navigation navigation-prev " aria-label="Previous page: Performance tests (DAMP)">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../files/" class="navigation navigation-next " aria-label="Next page: Files and directories">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Writing a new test","level":"1.4.4.1","depth":3,"next":{"title":"Files and directories","level":"1.5","depth":1,"path":"files/README.md","ref":"files/README.md","articles":[{"title":"Adding New Files","level":"1.5.1","depth":2,"path":"files/adding-files.md","ref":"files/adding-files.md","articles":[]}]},"previous":{"title":"Performance tests (DAMP)","level":"1.4.4","depth":2,"path":"tests/performance-tests.md","ref":"tests/performance-tests.md","articles":[{"title":"Writing a new test","level":"1.4.4.1","depth":3,"path":"tests/writing-perf-tests.md","ref":"tests/writing-perf-tests.md","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"tests/writing-perf-tests.md","mtime":"2019-04-20T22:43:15.657Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-04-20T22:44:41.076Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

